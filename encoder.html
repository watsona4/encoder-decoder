<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Encoder Ring</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font:
          16px system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          Arial;
        padding: 24px;
      }
      input[type="file"] {
        margin-bottom: 8px;
      }
      button {
        font: inherit;
        padding: 8px 12px;
        cursor: pointer;
      }
      #status {
        margin-top: 10px;
        font-family: monospace;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <input id="file" type="file" />
    <button id="convert">Encode</button>
    <div id="status">Idle.</div>

    <script>
      (async () => {
        const fileEl = document.getElementById("file");
        const btn = document.getElementById("convert");
        const statusEl = document.getElementById("status");

        function setStatus(msg) {
          statusEl.textContent = msg;
        }

        btn.addEventListener("click", async () => {
          const file = fileEl.files?.[0];
          if (!file) {
            setStatus("No file selected.");
            return;
          }

          setStatus(`Reading ${file.name}â€¦`);
          try {
            const payload = await toBase64(file);
            const full = `FILENAME:${file.name}\n${payload}`;
            await copyText(full);
            setStatus(`Encoded "${file.name}".`);
            fileEl.value = "";
          } catch (e) {
            console.error(e);
            setStatus("Error: " + (e.message || e));
          }
        });

        function toBase64(file) {
          return new Promise((resolve, reject) => {
            const r = new FileReader();
            r.onerror = () => reject(r.error);
            r.onload = () => {
              const s = r.result;
              const i = typeof s === "string" ? s.indexOf("base64,") : -1;
              resolve(i >= 0 ? s.slice(i + 7) : s);
            };
            r.readAsDataURL(file);
          });
        }

        async function copyText(t) {
          if (navigator.clipboard?.writeText)
            return navigator.clipboard.writeText(t);
          const ta = document.createElement("textarea");
          ta.value = t;
          ta.style.position = "fixed";
          ta.style.top = "-1000px";
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand("copy");
          document.body.removeChild(ta);
          if (!ok) throw new Error("Encoding failed");
        }
      })();
    </script>
  </body>
</html>
